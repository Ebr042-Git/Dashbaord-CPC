<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Project Dashboard</title>
<style>
  body { font-family: Arial; padding: 20px; }
  .progress-bar {
    width: 300px;
    height: 25px;
    background: #eee;
    border-radius: 5px;
    margin-bottom: 10px;
    position: relative;
  }
  .progress-fill {
    height: 100%;
    background: #4caf50;
    border-radius: 5px;
    text-align: center;
    color: white;
    line-height: 25px;
  }
  table {
    border-collapse: collapse;
    margin-top: 20px;
    width: 70%;
  }
  table, th, td {
    border: 1px solid #444;
    padding: 6px;
  }
</style>
</head>
<body>

<h1>ðŸ“Š Project Dashboard</h1>

<label>Select Module:</label>
<select id="moduleSelect"></select>

<h2>Module Progress</h2>
<div id="progressContainer"></div>

<h2>Task Table</h2>
<div id="tableContainer"></div>

<script>
// ðŸ”— Your deployed Google Apps Script Web App URL
const API_URL = "https://script.google.com/macros/s/AKfycby1BiRAYAX0kkKWkZ38iHWxb-nEH6wVnldHCUSI8H7c2qtQ9aBOYUsRO9ddeQbv6ZAm/exec";

// 1ï¸âƒ£ LOAD DATA FROM GOOGLE SHEET API
async function loadData() {
    try {
        const response = await fetch(API_URL);
        const data = await response.json();
        console.log("Loaded data:", data); // debug
        return data;
    } catch (err) {
        console.error("Error loading data:", err);
        return [];
    }
}

// 2ï¸âƒ£ POPULATE MODULE DROPDOWN
function populateModules(data) {
    const select = document.getElementById("moduleSelect");
    const modules = [...new Set(data.map(row => row.Module))];

    select.innerHTML = modules
        .map(m => `<option value="${m}">${m}</option>`)
        .join("");

    select.onchange = () => renderDashboard(data);
}

// 3ï¸âƒ£ RENDER DASHBOARD
function renderDashboard(data) {
    const module = document.getElementById("moduleSelect").value;
    const moduleData = data.filter(r => r.Module === module);

    // Progress = (Completed / Total) * 100
    const completed = moduleData.filter(r => r.Status.toLowerCase() === "done").length;
    const total = moduleData.length;
    const percent = total === 0 ? 0 : Math.round((completed / total) * 100);

    // Progress bar
    document.getElementById("progressContainer").innerHTML = `
        <div class="progress-bar">
            <div class="progress-fill" style="width:${percent}%">
                ${percent}%
            </div>
        </div>
    `;

    // Table
    let tableHTML = `
        <table>
            <tr>
                <th>Task</th>
                <th>Status</th>
                <th>Assignee</th>
                <th>Date</th>
            </tr>
    `;

    moduleData.forEach(row => {
        tableHTML += `
            <tr>
                <td>${row.Task}</td>
                <td>${row.Status}</td>
                <td>${row.AssignedTo}</td>
                <td>${row.Date}</td>
            </tr>
        `;
    });

    tableHTML += "</table>";
    document.getElementById("tableContainer").innerHTML = tableHTML;
}

// 4ï¸âƒ£ INITIALIZE DASHBOARD
async function init() {
    const data = await loadData();
    if (data.length > 0) {
        populateModules(data);
        renderDashboard(data);
    } else {
        document.getElementById("progressContainer").innerText = "No data found.";
    }
}

init();
</script>

</body>
</html>
